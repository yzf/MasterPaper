 \chapter{引言}

 \begin{center}
 \fbox{\parbox{120mm}{本章要点：
  \begin{itemize}
 % \addtolength{\itemsep}{-0.8em} % 缩小参考文献间的垂直间距
    \item {\fs 系统级设计的挑战要求提高设计的层次；}
    \item {\fs 目前所用的传统设计方法学以及设计工具难以适应这样的要求；}
    \item {\fs 系统的复杂性快速增长对设计的正确性也提出了很高的要求；}
    \item {\fs 形式方法是能够满足上述要求的较好的选择；}
    \item {\fs 本文的研究目标、范围与组织。}
  \end{itemize}}}
 \end{center}

 % \begin{center}
 %\fbox{\parbox{120mm}{本章要点：\\
  %\begin{itemize}
 %   {\fs 系统级设计的挑战；}\\
 %   {\fs 形式方法概述；}}}
  %\end{itemize}}}
% \end{center}

 \section{系统级设计的挑战}

 过去几十年来，微电子技术的高速发展所取得的巨大成就和人们对信息技术的强大需求使得现代集成
 电路系统的规模和复杂程度日趋提高。
 这必将导致对未来集成电路系统的设计、制造提出更高的要求。从目前集成电路的制造技术看，深亚微
 米制造技术的突破使得在单一硅片上实现信号采集、
 转换、存储、处理和输入/输出功能的片上系统~(systems-on-chip，SoC)~成为可能。相形之下，
 集成电路系统级的设计就越来越成为重要的因素。

 有关研究表明\upcite{Gajski00}，最近~20~年来，集成电路芯片每片上的晶体管的数量每年增长~58\%~，
 而相应时间内的设计
 生产力如果以每个设计师每天设计的晶体管的数量衡量，只增长了~21\%。该结果将导致在集成电路设计
 制造业中
 出现所谓~``生产创造力的鸿沟''~
 (productivity
 gap)~或所谓``设计瓶颈''问题，即出现相对发展缓慢的集成电路的设计能力落后于先进的集成电路制造技
 术的现象，设计师将不能有效地在相对短的时间内设计出各种产品，从而无法参与激烈的市场竞争。

 文献~\cite{Gajski00}~提出了解决以上问题的~3~条途径：

 (1)~提升系统设计的抽象层次，压缩设计对象的数目。这样，就必须相应地提高设计规范、体系结构、
 工具、设计方法学的抽象层次，开发更高层次的设计规范语言、实现模型以及验证技术。

 (2)~采用设计可重用部件。在系统级设计上尽可能采用知识产权~(intellectual
 properties，IP)~部件，充分利用已有的设计成果。

 (3)~采用系统级综合的方法。直接从系统级的规范进行综合。根据设计规范的要求，把规范划分为若干
 组需求，并将每组综合为定制或半定制的硬件。在确立了系统结构以后验证该结构是否符合系统规范。
 最后，编译成代码进而生成定制的实时操作系统~(real-time operating system，RTOS)。

 近年来所谓~``嵌入式系统''~(embedded
 systems)~得到了广泛的应用。所谓
 嵌入式系统，就是执行专用功能、但其内部包含了用户所看不见的计算机控制的设备或者系统
 \upcite{Edwards97}。

 在这样的包含了内嵌软件的软硬件混合系统~(hardware/software，HW/SW)~中，各部件之间的关系
 或者是同质的~(homogeneous)~或者是非同质的~(heterogeneous)，
 因此所需要的设计方法将更为困难和复杂。

 在嵌入式系统设计过程中，软硬件的边界划分是一个关键的技术\upcite{Edwards97}。
 如果在设计阶段过早地对系统的实现进行划分，将导致设计成本增加、设计时间延长。近年来提出的
 软硬件的协同设计~(hardware/software co-design)~的方法就是通过软、硬件的并行设计达到
 满足系统设计的目标。并行设计的主要思想是从高层开始建立系统级的抽象行为规范。详见文献
 ~\cite{Keutzer00,Sgroi00,Johnson03}。


 从以上分析可见，无论是解决集成电路设计瓶颈问题还是满足软硬件混合系统协同设计的需要，都要求
 提高集成电路设计的层次、增加设计的抽象程度。这一要求从目前集成电路设计的典型流程
 \upcite{YangZhilian99}
 来看~(见图~\ref{fig:tu1-1})，相当于把设计层次提高到系统级~(或行为设计级)。

 \begin{center}
 \includegraphics[width=23mm]{fig/tu1-1}
 \figcaption{\footnotesize 集成电路设计流程}
 \label{fig:tu1-1}
 %\end{minipage}
 \end{center}

 当我们提高了数字系统~(或集成电路系统)~的设计层次以后，目前所用的设计方法学、设计支撑工具
 等是否还适用？我们作如下的分析。
 首先，对于数字系统的行为级而言，一方面，用硬件描述语言~(hardware description
 languages，HDL)~描述是不合适的~(原因详见第~4~章)；另一方面，目前的数字系统设
 计的现状是，系统级的行为描述基本停留在
 使用自然语言的阶段\upcite{WangZhihua00,LinMin02}。显然，这样的行为描述缺乏严格性、完整性，
 无疑是不合适的；其次，
 无论是这一层次的设计方法学还是设计支撑工具
 都还是非常缺乏的\upcite{HongXianlong98}。这是因为，更高层次的设计规范语言、实现模型以及验
 证技术的开发都将极大地
 依赖于严格的数学方法，尤其是以形式语义及形式规范为主要特征的形式方法。这就要求研究与开发能够适
 应系统级设计的理论、设计方法学、设计支撑工具。

 另一方面，由于数字硬件系统~(或集成电路系统)~复杂性的快速增长，如何确保系统设计的正确性也是系统
 级设计面临的极大的挑战。在主要依靠设计师自身积累的经验
 的情况下，现有的设计验证技术也无法有效保证系统设计的正确性。
 据报道\upcite{Burgelman99,Colwell00}，1994~年，Intel~公司的~Pentium~芯片中的浮点除法运算错误是
 在其大量进入商用后才被一位用户发现的，虽然这种错误发生的概率为几亿分之一，但这个设计错误还是为
 ~Intel~公司造成~4.75~亿美圆的经济损失和无形的形象损失。

 研究适合于系统级设计的理论，开发新的、适合于系统级设计的工具，不断提高设计正确性的课题吸引了
 学者、设计师、生产
 厂商的大量研究，也进行了许多有益的实践和验证。其中一个方法就是采用~``形式化方法''~(formal
 methods)。所谓形式化方法，就是利用严格的数学方法，给出系统设计的规范~
 (specifications)~逐步地推导或者验证系统的方法。

 \section{传统的数字系统设计技术}

 传统的工业设计技术~(包括数字系统的设计)~过程首先是建立相应的数学模型；然后用数值计算各项参数；
 在与
 设计目标反复比较过程中修改或完善这个数学模型。例如，航空工程师在设计某个飞行器时利用计算流体
 动力学建立该飞行器的数学模型；经计算后把结果与预期的相比较，从而修改这个数学模型。这个过程反复
 进行，直至对结果与预期的一致。

 在数字系统的传统设计中，布尔代数是主要的理论基础或数学模型
 \upcite{LiuBaoqin93,LiuBihu99}。设计
 者根据设计的要求写出系统的输入、输出表达式或者状态图，然后采用真值表、卡诺图
 进行化简，如果是时序电路，还需要进行状态分配和指定触发器的激励函数，从而得到所需的数字系统。

 对于数字系统的设计师来说，系统设计规范~(specification)~并不是新鲜的概念。以集成电路设计领域
 为例，系统的设计规范包括系统的功能、性能和物理尺寸。此外，集成电路设计过程中还需考虑选择什
 么样的设计模式和制造工艺，以最终确定芯片的尺寸、工作速度、功耗和系统功能。

 上述的参数计算早期是用手工或简单计算工具完成的。随着计算机辅助设计的应用，设计领域中出现了许多
 求解数学模型计算机算法；比如，一些方程的
 数值解已经无须人工干预即可在计算机上进行。类似地，现代的电路~CAD~工具也能够取代设计师完成以前需
 要人工操作的、烦琐的状态化简、状态分配的过程。不可否认，把模型数学化的做法本身就是一种形式化的
 过程，数学模型的计算机的算法也是形式化的手段。但是，
 请注意，无论在飞行器设计还是在数字系统设计的过程中，如果没有
 把整个被设计的对象的行为描述完全数学化~(即形式化)，那么计算机在这里只是起到辅助设计，其设计方
 法也不属于形式方法。

 传统的设计方法有以下几个方面的弱点：

 1.
 传统的规范缺乏精确的形式语义定义。如前所述，传统的硬件设计方法主要依赖于经典数学，而
 经典数学中基本不考虑如何用符号的方法描述时间和系统构造的动态性质。例如，建立在经典的布尔代数、
 状态图基础上的硬件设计方法没有能力描述系统中各种事件复杂的时序关系，也不会考虑系统级的动态的
 并发特征。

 2.
 系统设计位于底层或趋于较低层。这是因为从函数的角度看，在传统设计过程中，设计规范和设计对象之间是
 一种一一对应~(one-to-one correspondence)~或双射~(bijection)~关系，即一对一~(one-to-one)~且映上
 ~(onto)~的映射关系，两者之间并不存在冗余的信息。这种关系一方面对设计者而言很
 容易把握设计对象的特点和性质，但另一方面也使设计者在系统日趋庞大和复杂的情况下很难看到整个系统的
 全貌，从而不能承担复杂系统的有效设计，延误了市场竞争的最佳时机。

 \section{形式方法}

 如何寻找新技术的突破点？近代计算机体系结构的理论和实践表明，软件与硬件的分界线渐趋模糊。许多原来
 用硬件的设计可以代之以软件，反之亦然。在数字电子计算机中，硬件代表了实体部件的结构与互相联系，而
 软件的主体就是程序，它更多地反映了展现给用户的计算机行为或者功能的能力。对纯粹的硬件设计师而言，
 这说明了有必要更多地从行为或者功能的角度观察和设计数字硬件。

 HDL~的使用为硬件设计师提供了一个非常好的分析和设计数字硬件的工具，也为沟通软件和硬件提供了
 一种方法。然而，这些~HDL~一般是为模拟数字硬件的功能而设计，缺乏对数字硬件推理和证明的机制；对行
 为描述的能力较弱~(通常只能用输入输出的关系描述硬件的行为)；缺乏形式设计或验证的支持工具。

 \subsection{形式方法概述}

 与上述传统的设计方法或者单纯利用~HDL~设计工具的设计方法不同，这里的~``形式方法''~是指建立在一组
 严格的数学基础和分析之上的技术。尤其是，它利用了非传统数学的工具~(如时态逻辑等概念)。它最
 初来源于软件工程领域。《计算机科学技术百科全书》对``形式方法''的定义是\upcite{ZhangXiaoxiang98}：

 {\hei ``建立在严格数学基础上的软件开发方法。软件开发的全过程中，从需求分析、规范、
 设计、编程、系统集成、
 测试、文档生成、直至维护各个阶段，凡是采用严格的数学语言，具有精确的数学语义的方法，都称为形式
 方法。''}

 在软件设计与研制中采用形式方法，可以追溯到~1950~年代后期对于程序设计师语言编译技术的研究。当时
 ~J.Backus~提出了~BNF~(Backus normal form，巴克斯范式)~记法\footnote{精确描述程序设计语言的语法
 的一种形式系统，见文献~\cite{Louden97,ChenHuowang00}}作为描述程序设计语言语法的元语
 言\footnote{在讨论语言系统时，通常要涉及到~2~种语言。一是被讨论的语言，它可称为{\hei 对象语言}；
 另一是讨论对象语言时所用的语言，可以称为{\hei 元语言}。两者通常不在一个层次。}。

 形式方法的一个重要研究内容是形式规范~(formal
 specification)，即使用具有精确语义的形式语言书写的程序功能描述。一旦给出系统的形式规范，就可以
 推断它是否具有某种性质。这些性质虽然并不是规范的一部分，但由于规范是形式的，所以可以在相应的
 形式推理系统中由推导得到。如果用~$Spec$，$P$~和~$Sys$~分别表示规范、性质和程序，用~$\vdash$~和
 ~$\vDash$~分别表示推导和满足关系，并假定所用的推理系统是可靠的，那么从
   $$Spec\vdash P~~\mbox{与}~~Sys\vDash Spec$$
 就知道
  $$Sys\vDash P$$
 换言之，只要规范具有性质~$P$，则任何正确地实现了该规范的程序都满足~$P$。这就保证从设计规范开始
 到最终阶段，最大限度地避免了设计过程中可能出现的错误。

 这里我们试图给出数字电路系统的形式设计的定义如下：

 \begin{definition}

 建立在严格数学基础上的硬件设计方法。在设计的全过程中，从需求分析、规范、
 设计、到推导阶段都采用严格的数学语言，并且具有精确的数学语义的方法。最后给出的是被设计系统的硬
 件描述语言~(HDL)~的代码。
 \end{definition}

 形式方法的特点是：把设计集中在系统的最高层次，而不是过早地
 拘泥于具体的设计细节问题，这样可以大大缩短设计时间；基于形式方法的设计还可以充分借鉴软件
 的形式设计方法，并且能够采用如同编制高级程序设计语言那样的工作方式。

 试想，如果我们从描述系统级的设计规范开始，运用严格的数学推导的办法，在计算机系统的支持下，
 把系统规范逐步精化成为具体的硬件描述语言。在未来，人们将开发从系统级到算法级的~CAD~工具。到那时，
 系统级设计的瓶颈将可能得到解决；同时，设计的正确性问题也能有效地得到保证。

 我们可以乐观地认为，以形式规范及形式语义学为主要内容的形式设计方法将带来数字系统硬件方法
 学上的革命性变化，它将有力地冲击把硬件与软件分别对待的传统观念，并将极大地提高集成电路
 ~CAD~的工作效率。


 \subsection{形式方法在数字硬件系统中的应用}

 尽管形式技术在软件工程领域已经早已得到应用，但
 形式方法在数字硬件系统的应用是一项全新的技术。一般而言，它可以分为两类，即：形式设计与形式验证。

 1. {\hei 形式设计}~(Formal Design)

 数字系统的形式设计的主要思想来源于计算机科学对程序尤其是并发程序可以转换为电路的核心概念。
 在系统设计的早期阶段就采用形式方法，而不是象传统设计那样，在设计阶段的后期在寄存器传输级
 ~(register transfer level，RTL)~进行验证，如果不符合要求，重新开始前端设计。

 一个系统设计过程可以看作是把一个设计规范经过一系列的转换步骤成系统实现的过程。
 具体地，基于形式方法的设计应当包括以下几个方面：
 \begin{itemize}
  \item 功能规范。用严格的数学方法描写系统或者子系统的行为功能；
  \item 形式系统。一组关于输入、输出、状态之间的关系的性质；
  \item 设计约束。设计中必须满足的一些要求。
 \end{itemize}

 整个设计过程是：从功能规范出发，把它作为最高层的抽象，然后运用精化~(refinement)~技术，将高层
 行为规范逐步具体化为比较低层的实现。文献~\cite{Edwards97}~对此有详细的阐述。

 事实上，在系统的高层，硬件和软件是没有区别的。我们完全可以利用软件设计中的形式方法进行硬件设计。

 2. {\hei 形式验证}~(Formal Verification)

 形式验证技术是一种根据逻辑设计的功能和结构的描述，用类似定理证明的方法或数学的方法来证明
 逻辑设计正确性的技术。与形式设计的情况不同的是，目前形式验证技术是一个研究的热点，它的理论和
 实践不仅在数字电路中有极大的实用性，也引起了计算机科学理论、和软件等学科不少学者的注意，并且有
 相当好的前景。

 传统的集成电路设计只能对它进行在指定环境下的模拟验证。

 然而，这种模拟验证技术至少存在着以下~2~方面的缺点：

 (1)~模拟验证是一项非常耗时的工作。

 (2)~不管如何设计模拟验证的环境，其验证的范围总是有限的，不可能穷尽所有的实际情况。

 所以这种方法已经越来越不适应于目前的工业生产的实际。

 Wagner\upcite{Wagner77}~在1977年首先利用一阶逻辑定理证明系统~FOL~(First Order
 Logic)，用基于符号处理的形式推理方法，成功地对一些计数器、寄存器和一个~8~位的乘法器等部件进行了
 验证。

 继~Wagner~之后，出现了许多新的形式验证系统。例如，Hunt\upcite{Hunt89,Hunt94}~运用~Boyer-Moore~
 定理证明器验证了微处理器~FM8501，其高层次描述用~Boyer-Moore~逻辑描述形式以指令级给出，低层次以
 门级给出。

 英国学者~M.J.C. Gordon\upcite{Gordon93}~利用高阶逻辑~HOL~(Higher Order
 Logic)对数字系统的形式验证作出了贡献。

 目前，主要存在着以下几种形式验证的技术。

 (1)~模型检验(Model Checking)

 首先把验证对象的有限状态变化抽取出来。然后利用搜索技术对状态空间进行检查，验证是否满足特定的规约
 (Specification)。

 (2)~定理证明(Theorem Proving)

 这是一种基于人工智能的技术。

 关于较为完整的形式验证技术的综述，请见~\cite{Clarke96,Christoph99}。

 两种技术虽然不同，但两者之间存在着不可分割的关系。首先，它们都涉及形式规范的选择、使用的问题；
 其次，在形式设计的过程中，可以要求使用形式验证技术来保证设计的正确性。

 \subsection{形式方法成功的范例}

 总体上，对形式设计的理论和实践研究较少，运用形式设计的硬件设计的范例不多。下面仅例举近年来有一些
 值得一提的设计形式方法在工业界的应用。

 1.~{\hei IBM~公司~ASCI~BLUE~超级计算机的~cache~协议的形式设计}

 IBM~公司已经成功应用形式方法设计了~ASCI~BLUE~超级计算机\upcite{German03}~中~cache~存储器协议
 控制器。ASCI~BLUE~是为美国能源部所属~Lawrence Livermore~国家实验室开发的系列超级计算机之一。
 它具有~512~个节点，每个节点包含~8--16~个处理器。在~1999~年~11~月的世界超级计算机~500~强排名中
 位于第~2~位\footnote{见~\href{http://www.top500.org/list/1999/11/}{http://www.top500.org/ %
  list/1999/11/}}。

 传统上，Cache~存储器协议的方法是从设计协议表格开始然后再转化成逻辑表达式。这样做的缺点是这类
 表格表示的需求不准确，而且因为其结构比较复杂在转化时可能引出一些错误。采用了形式化方法后，设计
 分为~3~层，即高层、流水线层和逻辑层；各层都建立了相应的形式模型；并利用形式验证系统~Murphi~对
 高层和流水线层进行模型检验。这些措施的使用取得了较好的效果，逻辑层的设计提前完成，并且很少有
 错误发生。文献~\cite{Cindy00}~也阐述了这方面的应用。

 2.~{\hei 微处理器的形式验证}

 1991~年~Boyer~和~Yu~针对~Motorola~68020~微处理器设计了一种形式验证所需的规范\upcite{Boyer96}。
 他们使用这些规范证明了许多来自高级语言编译器产生的~2~进制的机器代码的正确性。

 1995~年~Appenzeller~和~Kuehlmann~报导了形式方法在~PowerPC~微处理器设计中的应用
 \upcite{Appenzeller95}。
 在设计的顶层，使用~VHDL~描述~RTL~(register-transfer-language，
 寄存器传输级)~的设计规范，而管级的实现则应用了~Verity~形式验证工具\upcite{Kuehlmann95}
 以保证与其设计规范的等价。


 \subsection{形式设计方法与有关概念的区别与联系}

 从上面关于数字系统形式设计的概念可见，形式设计的主要任务是从用户的需求开始，用严格的形式语言
 描述需求，进而使用一系列的精化的方法推导出能满足用户需求的系统的实现代码或者其他形式的结果。
 除了满足数字硬件设计以外，还可望应用于~SoC~或~HW/SW~系统级的设计和精化。

 {\hei 规范}与{\hei 形式规范}的联系与区别：共同点：均可表示对系统设计的要求。区别：常见的数字
 系统规范所使用的形式可以是布尔表达式、波形、
 卡诺图、甚至是自然语言；形式规范的形式一般是逻辑表达式，包括经典的命题逻辑、一阶逻辑、模态逻辑、
 高阶逻辑，
 最常见的可能是时态逻辑~(一种特殊的模态逻辑)~及其众多的变形，如分枝逻辑、线形时态逻辑~(详见
 第~2~章)。形式规范所表示的抽象能力大于一般的规范。

 {\hei
 硅编译器：}硅编译器是一种把数字电路行为级描述直接转换为硅芯片掩膜版图的设计技术，其转换过程
 类似于软件编译器，将高级语言转换成机器语言。硅编译的基本思想就是把~VLSI~设计的知识算法化，通过
 翻译程序把高级描述直接地自动地翻译成相应的几何掩膜设计。

 {\hei
 系统的行为级综合：}从描述系统的代码开始，直接把代码生成相应的电路或模块。

 \section{本文的研究动机、目标和范围}

 虽然数字硬件的形式设计的思想早已存在，并有一些理论与实际工作者的不断研究成果的积累。但长期以来，
 由于种种原因，形式方法、尤其是数字硬件的形式设计的理论及方法都是研究的``冷门''，这些现象对于
 当前亟待发展的集成电路的系统新的设计方法是极为不利的。

 为了研究集成电路的高层的行为抽象，保证数字系统设计的正确性，本文将试图研究数字系统形式设计所涉及
 的主要理论、方法和技术；探讨在系统级的层次应用形式设计的可行性，并将提出一种新的数字硬件形式化
 设计方法。

 这些理论适用于~VLSI~设计的系统设计到功能设计的阶段。在这一阶段，设计师主要的任务就是按照系统
 的需求完成系统的功能设计。

 超大规模集成电路的设计是形式设计的原始需求，这种需求极大地促进了形式设计的理论和实践的发展。但是，
 形式设计的理论与实践的应用并不仅仅局限于集成电路设计本身。本文的研究目标、和结果对普通的数字电路
 系统也是适合的。

 由于本文定位在数字硬件的形式设计，因此，本文的讨论范围是形式设计的主要原理和方法，并不涉及
 嵌入式系统设计或者~HW/SW~系统设计的具体方法。

 \section{作者获得的主要成果}

 1.~提出了应用于数字系统的形式设计的计算模型~FCMHD~(formal computational model for hardware design)。
 这是一个基于两层的形式设计模型。给出了~FCMHD~的区间时态逻辑~(Interval Temporal
 Logic，ITL)~语义。

 2.~以时段演算~(duration calculus，DC)~为工具对~VHDL~的子集进行了形式语义分析；通过分析~VHDL~和~
 Verilog HDL~部分语句的形式语义，为硬件描述语言的分析、设计、编译提供了一个严格的理论基础和新的途径。
 同时也为本文后半部分提出新的硬件描述语言~CHDL~作好准备。

 3.~针对目前形式设计过程中存在的问题提出了两层形式设计方法。该方法对于简化形式设计的过程将
 有效降低设计过程的复杂性。

 4.~提出了``基本硬件描述语言''~CHDL~(core hardware description language)，该语言的抽象程度要稍高于
 目前常见的硬件描述语言，但又很容易将其转换为常见的硬件描述语言。给出了~CHDL~的形式语义及常用的
 硬件的语义；提出了把~CHDL~转换为~VHDL~或~Verilog HDL~的方法。

 5.~论述了~FCMHD~的精化演算并给出了具体的精化规则；论述了~ITL~的复合验证。

 6.~运用前面讨论的理论和方法，研究了一个比较大的实例。描述了从给出高层设计规范到利用精化公式逐步
 导出设计问题的代码的过程。


 \section{本文的组织结构}

 第~1~章为引言，第~2~章主要对目前数字集成电路形式设计中形式化方法作一个详尽的回顾；第~3~章针对目前
 的形式方法的缺点提出作者的新方案。第~4~章将讨论~CHDL~的形式语义；第~5~章将讨论~FCMHD~系统
 的精化演算
 及其规则；在第~6~章作者给出了一个完整的实例。最后一章给
 出了本文的总结，并指出了未来研究的方向。以下是关于各章内容的较为详细的介绍：

 第~2~章首先介绍数字系统形式设计的早期研究成果，以期对读者有启发作用。之后，主要对全文所用的形式
 设计方法的各种逻辑系统、形式规范、精化演算等主要概念做了系统的回顾；
 在此基础上，较为详细地分析了几种有关数字系统形式设计的理论和方法以及它们的特点，以期为后继的章节
 作一个铺垫。

 从第~3~章开始，论文将着重讨论作者提出的~FCMHD~形式系统的定义。首先，在第~3~章给出作者提出的
 ~FCMHD~形式系统在区间时态逻辑下的形式语义。为了使本文结果更为一般化，作者提出了比一般硬件设计语言
 更高级的所谓 ``基本硬件描述语言''~CHDL。

 为实现作者提出两层的形式设计方法，需要把用~FCMHD~的代码进一步精化为~CHDL~代码。因此，在
 在第~4~章中，前面的内容是使用~FCMHD~对~CHDL~的各种语句进行形式语义分析，后面的内容主要讨论如何把~CHDL~
 转换为一般的~HDL。

 第~5~章，作者对所用到的精化演算进行了实时的扩充。提出了精化演算的若干条规则。这些精化规则对于
 后继章节的形式设计是非常重要的，也是根本的。

 接着在第
 ~6~章，作者对一个比较大的实例进行了研究。首先根据要求我们提出了它的设计形式规范，在此基础上利用
 第~3、4~章提出的~FCMHD~计算模型和~CHDL~对形式规范进行精化，逐步推导出接近实际使用的~HDL~的代码。

 在最后一章，作者对全文所提到的模型与理论进行了简要的总结，指出了其不足之处；同时还展望了今后的
 工作。

 \section{本章小结}

 本章首先分析了现代集成电路中系统级设计所要遇到的~2~个挑战，即设计能力落后于制造能力；如何确保
 系统设计的正确性。通过分析可以知道，首先，无论是解决集成电路设计瓶颈问题，还是满足软硬件混合系统
 协同设计的需要，都要求提高系统设计的层次；其次，系统的复杂性对系统级设计的正确性提出了一个极大
 的挑战。同样，在一个含有集成电路的复杂系统或者~HW/SW~内部，作为硬件的设计正确性以及其验证对整个
 系统的可靠性具有决定性的意义。形式方法是一种严格的系统方法，其基础建立在精确的语义模型上，并采取
 逐步精化系统设计规范的方法，最终推导出系统的~HDL~的描述。
